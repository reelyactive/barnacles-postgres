#!/usr/bin/env node

const os = require('os');
const exec = require('child_process').exec;

// User = reelyactive, Database = pareto_anywhere, Host = 127.0.0.1
const LINUX_CMD = "psql -U reelyactive -h 127.0.0.1 -d pareto_anywhere -c \"" +
                  "CREATE INDEX raddec_transmitter_idx ON raddec (transmittersignature);" +
                  "CREATE INDEX raddec_timestamp_idx ON raddec USING BRIN(timestamp);" +
                  "CREATE INDEX dynamb_device_idx ON dynamb (devicesignature);" +
                  "CREATE INDEX dynamb_timestamp_idx ON dynamb USING BRIN(timestamp);" +
                  "CREATE INDEX spatem_device_idx ON spatem (devicesignature);" +
                  "CREATE INDEX spatem_timestamp_idx ON spatem USING BRIN(timestamp);" +
                  "\"";

// Linux
if(os.platform() === 'linux') {
  console.log('When prompted, enter the password for the reelyactive user.');
  exec(LINUX_CMD, (err) => {
    if(err) { return console.log(err.message); }
    else {
      console.log('Indexed raddec transmitterSignature & timestamp');
      console.log('Indexed dynamb deviceSignature & timestamp');
      console.log('Indexed spatem deviceSignature & timestamp');
    }
  });
}

// Unsupported OS
else {
  return console.log('This script currently supports Linux only.');
}