#!/usr/bin/env node

const os = require('os');
const exec = require('child_process').exec;

// User = reelyactive, Database = pareto_anywhere, Host = 127.0.0.1
const LINUX_CMD = "psql -U reelyactive -h 127.0.0.1 -d pareto_anywhere -c \"" +
                  "CREATE TABLE raddec (_storeid bigint GENERATED ALWAYS AS IDENTITY, transmittersignature varchar(36) NOT NULL, timestamp timestamptz DEFAULT current_timestamp, raddec JSONB NOT NULL);" +
                  "CREATE TABLE dynamb (_storeid bigint GENERATED ALWAYS AS IDENTITY, devicesignature varchar(36) NOT NULL, timestamp timestamptz DEFAULT current_timestamp, dynamb JSONB NOT NULL);" +
                  "CREATE TABLE spatem (_storeid bigint GENERATED ALWAYS AS IDENTITY, devicesignature varchar(36) NOT NULL, timestamp timestamptz DEFAULT current_timestamp, spatem JSONB NOT NULL);" +
                  "SELECT AddGeometryColumn ('spatem','geom',4326,'POINT',3);" +
                  "\"";

// Linux
if(os.platform() === 'linux') {
  console.log('When prompted, enter the password for the reelyactive user.');
  exec(LINUX_CMD, (err) => {
    if(err) { return console.log(err.message); }
    else {
      console.log('Created raddec, dynamb and spatem tables');
    }
  });
}

// Unsupported OS
else {
  return console.log('This script currently supports Linux only.');
}